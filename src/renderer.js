var y=new WeakMap;window.__VUE_ELEMENTS__=y;function U(s){s.bum||(s.bum=[]),s.bum.push(()=>{let e=s.vnode.el;if(e){let t=y.get(e);t?.length==1?y.delete(e):t?.splice(t.indexOf(s)),e.__VUE__?.length==1?e.__VUE__=void 0:e.__VUE__?.splice(e.__VUE__.indexOf(s))}})}function N(s){let e;Object.defineProperty(s.vnode,"el",{get(){return e},set(t){e=t,e&&k(s)}})}function k(s){let e=s.vnode.el;for(;!(e instanceof HTMLElement);)e=e.parentElement;e.__VUE__?e.__VUE__.push(s):e.__VUE__=[s],e.classList.add("vue-component");let t=y.get(e);t?t.push(s):y.set(e,[s]),U(s)}function A(){window.Proxy=new Proxy(window.Proxy,{construct(s,[e,t]){let r=e?._;return r?.uid>=0&&(r.vnode.el?k(r):N(r)),new s(e,t)}})}var q=LLAPI_PRE.ipcRenderer_LL,C=LLAPI_PRE.ipcRenderer_LL_on,O=LLAPI_PRE.set_id;function T(s,e=0){return e>3?"...":typeof s!="object"||s===null?String(s):Array.isArray(s)?`[${s.map(n=>T(n,e+1)).join(", ")}]`:`{${Object.entries(s).map(([r,n])=>`${r}: ${T(n,e+1)}`).join(", ")}}`}function V(s){return T(s,null)}function D(){let s=async(e,...t)=>{let r=[];for(let n of t)r.push(typeof n=="string"?n:await V(n));LLAPI_PRE.ipcRenderer_LL.send("___!log",e,...r)};[["debug",0],["log",1],["info",2],["warn",3],["error",4]].forEach(([e,t])=>{let r=console[e];console[e]=(...n)=>{s(t,...n),r.apply(console,n)}})}D();var{webContentsId:h}=q.sendSync("___!boot");h||(h="2");function a(s,e,t,r=!1){return new Promise(async(n,i)=>{let c=crypto.randomUUID();C(`LL_DOWN_${c}`,(o,l)=>{n(l)}),O(c,h),q.send(`IPC_UP_${h}`,{type:"request",callbackId:c,eventName:`${s}-${h}${r?"-register":""}`},[e,...t])})}var G=LLAPI_PRE.exists,K=LLAPI_PRE.getSilk,P=class{async prepareImageElement(e){let t=await a("ns-FsApi","getFileType",[e]),r=await a("ns-FsApi","getFileMd5",[e]),n=`${r}.${t.ext}`,i=await a("ns-ntApi","nodeIKernelMsgService/getRichMediaFilePathForGuild",[{path_info:{md5HexStr:r,fileName:n,elementType:2,elementSubType:0,thumbSize:0,needCreate:!0,downloadType:1,file_uuid:""}}]);await a("ns-FsApi","copyFile",[{fromPath:e,toPath:i}]);let c=await a("ns-FsApi","getImageSizeFromPath",[e]),o=await a("ns-FsApi","getFileSize",[e]);return{md5HexStr:r,fileSize:o,picWidth:c.width,picHeight:c.height,fileName:n,sourcePath:i,original:!0,picType:1001,picSubType:0,fileUuid:"",fileSubId:"",thumbFileSize:0,summary:""}}async preparePttElement(e){let t=e.split(".").pop(),r=await K(e),n=r.path,i=await a("ns-FsApi","getFileMd5",[n]),c=`${i}.${t}`,o=await a("ns-ntApi","nodeIKernelMsgService/getRichMediaFilePathForGuild",[{path_info:{md5HexStr:i,fileName:c,elementType:2,elementSubType:0,thumbSize:0,needCreate:!0,downloadType:1,file_uuid:""}}]);await a("ns-FsApi","copyFile",[{fromPath:n,toPath:o}]);let l=await a("ns-FsApi","getFileSize",[o]);return{fileName:c,filePath:o,md5HexStr:i,fileSize:l,duration:r.duration/1024,formatType:1,voiceType:1,voiceChangeType:0,canConvert2Text:!0,waveAmplitudes:[0,18,9,23,16,17,16,15,44,17,24,20,14,15,17],fileSubId:"",playState:1,autoConvertText:0}}async downloadMedia(e,t,r,n,i,c){if(!await G(c))return await a("ns-ntApi","nodeIKernelMsgService/downloadRichMedia",[{getReq:{msgId:e,chatType:n,peerUid:r,elementId:t,thumbSize:0,downloadType:1,filePath:i}},void 0])}},_=new P;var L=class{constructTextElement(e){return{type:"text",content:e.textElement.content,raw:e}}constructFaceElement(e){return{type:"face",faceIndex:e.faceElement.faceIndex,faceType:e.faceElement.faceType==1?"normal":e.faceElement.faceType==2?"normal-extended":e.faceElement.faceType==3?"super":e.faceElement.faceType,faceSuperIndex:e.faceElement.stickerId&&parseInt(e.faceElement.stickerId),raw:e}}constructRawElement(e){return{type:"raw",raw:e}}constructImageElement(e,t){return{type:"image",file:e.picElement.sourcePath,downloadedPromise:_.downloadMedia(t.msgId,e.elementId,t.peerUid,t.chatType,e.picElement.thumbPath.get(0),e.picElement.sourcePath),raw:e}}constructMessage(e){let t=[],r=e.elements.map(n=>{if(n.elementType==1)return this.constructTextElement(n);if(n.elementType==2){let i=this.constructImageElement(n,e);return t.push(i.downloadedPromise),i}else return n.elementType==6?this.constructFaceElement(n):this.constructRawElement(n)});return{allDownloadedPromise:Promise.all(t),peer:{uid:e.peerUid,name:e.peerName,chatType:e.chatType==1?"friend":e.chatType==2?"group":"others"},sender:{uid:e.senderUid,memberName:e.sendMemberName||e.sendNickName,nickName:e.sendNickName},elements:r,raw:e}}constructUser(e){return{uid:e.uid,qid:e.qid,uin:e.uin,avatarUrl:e.avatarUrl,nickName:e.nick,bio:e.longNick,sex:{1:"male",2:"female",255:"unset",0:"unset"}[e.sex]||"others",raw:e}}constructGroup(e){return{uid:e.groupCode,avatarUrl:e.avatarUrl,name:e.groupName,role:{4:"master",3:"moderator",2:"member"}[e.memberRole]||"others",maxMembers:e.maxMember,members:e.memberCount,raw:e}}constructFace(e,t,r){let n=document.createElement("msg-qqface"),i={type:"qqFace",id:e,label:t,path:r,animationData:{packId:"1",stickerId:"28",stickerType:1,sourceType:1,resultId:"",superisedId:"",randomType:1}};return n.setAttribute("data",JSON.stringify(i)),n.outerHTML}},p=new L;var I=class{events;constructor(){this.events={}}on(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}once(e,t){let r=(...n)=>{t(...n),this.off(e,r)};this.on(e,r)}off(e,t){this.events[e]&&(this.events[e]=this.events[e].filter(r=>r!==t))}emit(e,...t){this.events[e]?.forEach(n=>{n(...t)})}};var S=class{destructTextElement(e){return{elementType:1,elementId:"",textElement:{content:e.content,atType:e.atType||0,atUid:e.atUid||"",atTinyId:"",atNtUid:e.atNtUid}}}destructXmlElement(e){return{elementType:8,elementId:"",grayTipElement:{subElementType:12,extBufForUI:"0x",xmlElement:{busiType:"1",busiId:"10145",c2cType:0,serviceType:0,ctrlFlag:7,content:'<gtip align="center"><qq uin="u_4B8ETD3ySVv--pNnQAupOA" col="3" jp="1042633805" /><nor txt="\u9080\u8BF7"/><qq uin="u_iDVsVV8gskSMTB51hSDGVg" col="3" jp="1754196821" /> <nor txt="\u52A0\u5165\u4E86\u7FA4\u804A\u3002"/> </gtip>',templId:"10179",seqId:"1313801018",templParam:{},pbReserv:"0x",members:{}}}}}destructImageElement(e,t){return{elementType:2,elementId:"",picElement:t}}destructPttElement(e,t){return{elementType:4,elementId:"",pttElement:t}}destructReplyElement(e){return{elementType:7,elementId:"",replyElement:{replayMsgSeq:e.msgSeq,replayMsgId:e.msgId,senderUin:e.senderUin,senderUinStr:e.senderUinStr}}}destructFaceElement(e){return{elementType:6,elementId:"",faceElement:{faceIndex:e.faceIndex,faceType:e.faceType=="normal"?1:e.faceType=="normal-extended"?2:e.faceType=="super"?3:e.faceType,...(e.faceType=="super"||e.faceType==3)&&{packId:"1",faceText:e.faceText.toString(),stickerId:(e.stickerId||"0").toString(),imageType:1,stickerType:e.stickerType||1,sourceType:1,resultId:"",superisedId:"",randomType:1}}}}destructRawElement(e){return e.raw}destructPeer(e){return{chatType:{friend:1,group:2,temp:100}[e.chatType]||e.chatType,peerUid:e.uid,guildId:""}}},m=new S;var x=[],E=[],w=[],f=LLAPI_PRE.ipcRenderer_LL_on,v=class extends I{add_editor(e){try{let t,n=document.querySelector(".ck.ck-content.ck-editor__editable").ckeditorInstance.model,c=n.document.selection.getFirstPosition();return n.change(o=>{if(e.type=="qqFace"){let l={type:"qqFace",id:e.id,label:e.label,path:e.path,animationData:{packId:"1",stickerId:"28",stickerType:1,sourceType:1,resultId:"",superisedId:"",randomType:1}},u={data:JSON.stringify(l)};t=o.createElement("msg-qqface",u)}else if(e.type=="pic"){let l={type:"pic",src:e.src,picSubType:0},u={data:JSON.stringify(l)};t=o.createElement("msg-img",u)}else e.type=="text"&&(t=e.content);o.insert(t,c)}),!0}catch{return!1}}set_editor(e){try{let t=window.getSelection();document.querySelector(".ck.ck-content.ck-editor__editable").ckeditorInstance.setData(e);let r=document.querySelector(".ck.ck-content p");return t.collapse(r.childNodes[r.childNodes.length-1]),t.modify("move","forward","paragraph"),!0}catch{return!1}}del_editor(e,t=!1){try{let n=document.querySelector(".ck.ck-content.ck-editor__editable").ckeditorInstance.model;return n.change(i=>{let c=n.document.getRoot(),o=c.getChild(1)??c.getChild(0);if(o&&o.is("element","paragraph")){let u=Array.from(o.getChildren()).find(g=>g.name==e);if(i.remove(u),t){let M=n.document.selection.getFirstPosition(),F=i.createRange(M.getShiftedBy(-1),M);i.remove(F)}}}),!0}catch{return!1}}get_editor(){return document.querySelector(".ck.ck-content.ck-editor__editable").ckeditorInstance.getData()}add_message_list(e,t){LLAPI_PRE.ipcRenderer_LL.send("___!add_message_list",e,t)}add_qmenu(...e){E.push(e)}add_qGuildMenu(...e){w.push(e)}async getAccountInfo(){return await a("ns-GlobalDataApi","fetchAuthData",[]).then(e=>{if(e)return{uid:e.uid,uin:e.uin}})}async getUserInfo(e){return a("ns-ntApi","nodeIKernelProfileService/getUserSimpleInfo",[{force:!0,uids:[e]},void 0]),await new Promise(t=>{this.once("user-info-list",r=>t(p.constructUser(r?.[1]?.[0]?.payload?.profiles?.get(e))))})}async getPeer(){return await LLAPI_PRE.get_peer()}async sendMessage(e,t){a("ns-ntApi","nodeIKernelMsgService/sendMsg",[{msgId:"0",peer:m.destructPeer(e),msgElements:await Promise.all(t.map(async n=>n.type=="text"?m.destructTextElement(n):n.type=="reply"?m.destructReplyElement(n):n.type=="image"?m.destructImageElement(n,await _.prepareImageElement(n.file)):n.type=="voice"||n.type=="ptt"?m.destructPttElement(n,await _.preparePttElement(n.file)):n.type=="face"?m.destructFaceElement(n):n.type=="raw"?m.destructRawElement(n):null)),msgAttributeInfos:new Map},null]);function r(){return new Promise((n,i)=>{x.length>0?n(x.pop()):setTimeout(()=>{n(r())},500)})}return r()}async recallMessage(e,t){a("ns-ntApi","nodeIKernelMsgService/recallMsg",[{msgIds:t,peer:m.destructPeer(e)},null])}async forwardMessage(e,t,r){a("ns-ntApi","nodeIKernelMsgService/forwardMsgWithComment",[{msgIds:r,srcContact:m.destructPeer(e),dstContacts:[m.destructPeer(t)],commentElements:[],msgAttributeInfos:new Map},null])}async getFriendsList(e=!1){return a("ns-ntApi","nodeIKernelBuddyService/getBuddyList",[{force_update:e},void 0]),await new Promise(t=>{this.once("friends-list-updated",r=>t(r))})}async getGroupsList(e=!1){return a("ns-ntApi","nodeIKernelGroupService/getGroupList",[{forceFetch:e},void 0]),await new Promise(t=>{this.once("groups-list-updated",r=>t(r))})}async getPreviousMessages(e,t=20,r="0"){try{return(await a("ns-ntApi","nodeIKernelMsgService/getMsgsIncludeSelf",[{peer:m.destructPeer(e),msgId:r,cnt:t,queryOrder:!0},void 0])).msgList.map(c=>p.constructMessage(c))}catch{return[]}}async Ptt2Text(e,t,r){let n=JSON.parse(JSON.stringify(r));await a("ns-ntApi","nodeIKernelMsgService/translatePtt2Text",[{msgId:e,peer:m.destructPeer(t),msgElement:n},null])}async getGroupMemberList(e,t=30){let r=await a("ns-ntApi","nodeIKernelGroupService/createMemberListScene",[{groupCode:e,scene:"groupMemberList_MainWindow"}]);return await a("ns-ntApi","nodeIKernelGroupService/getNextMemberList",[{sceneId:r,num:t},null])}async resetLoginInfo(e){await a("ns-ntApi","nodeIKernelLoginService/resetLoginInfo",[{uin:e},null])}async addLike(e,t=1){a("ns-ntApi","nodeIKernelProfileLikeService/setBuddyProfileLike",[{doLikeUserInfo:{friendUid:e,sourceId:71,doLikeCount:t,doLikeTollCount:0}},null])}async test(){let e=await this.getPeer();await this.sendMessage(e,[{type:"ptt",file:"H:/LiteLoader/xm2467.wav"}])}},d=new v;f("new_message-main",(s,e)=>{let t=(e?.[1]?.[0]?.payload?.msgList).map(r=>p.constructMessage(r));d.emit("new-messages",t)});f("new-send-message-main",(s,e)=>{let t=e?.[1]?.[0]?.payload?.msgRecord;t=p.constructMessage(t),x.push(t),d.emit("new-send-messages",[t])});f("user-info-list-main",(s,e)=>{d.emit("user-info-list",e)});f("set_message-main",s=>{d.emit("set_message")});f("groups-list-updated-main",(s,e)=>{let t=(e[1]?.[0]?.payload?.groupList||[]).map(r=>p.constructGroup(r));d.emit("groups-list-updated",t)});f("friends-list-updated-main",(s,e)=>{let t=[];(e?.[1]?.[0]?.payload?.data||[]).forEach(r=>t.push(...(r?.buddyList||[]).map(n=>p.constructUser(n)))),d.emit("friends-list-updated",t)});f("user-login-main",(s,e)=>{d.emit("user-login",e)});Object.defineProperty(window,"LLAPI",{value:d,writable:!1});Object.defineProperty(window,"llapi",{value:d,writable:!1});var R=!1;function b(s){let{target:e}=s,{classList:t}=e;if(t?.[0]!=="q-context-menu"&&typeof qContextMenu<"u"&&(qContextMenu.innerText.includes("\u8F6C\u53D1")||qContextMenu.innerText.includes("\u8F6C\u6587\u5B57"))){let r=e.closest(".ml-item")?.id;qContextMenu.innerText.includes("\u8F6C\u6587\u5B57")&&e.classList.add("ptt-element__progress"),d.emit("context-msg-menu",s,e,r)}}function z(){new MutationObserver((e,t)=>{for(let{type:r,addedNodes:n}of e)r==="childList"&&n.forEach(i=>{if(i.nodeType===Node.ELEMENT_NODE&&(i.querySelectorAll(".image.pic-element").forEach(o=>{o.addEventListener("contextmenu",b)}),i.querySelectorAll(".image.market-face-element").forEach(o=>{o.addEventListener("contextmenu",b)})),i?.previousSibling?.classList?.[0]==="q-context-menu"&&(i?.previousSibling?.innerText.includes("\u8F6C\u53D1")||i?.previousSibling?.innerText.includes("\u8F6C\u6587\u5B57"))&&E.length>0){let o=i.previousSibling.getBoundingClientRect(),l=document.elementFromPoint(o.x,o.y);E.forEach(u=>{u.forEach(g=>{g(i.previousSibling,l)})})}if(i?.classList?.[0]==="context-menu"&&i?.innerText.includes("\u590D\u5236")&&w.length>0){let o=i.getBoundingClientRect(),l=document.elementFromPoint(o.x,o.y);w.forEach(u=>{u.forEach(g=>{g(i,l)})})}(i.className==="ml-item"||i.className==="message vue-component")&&d.emit("dom-up-messages",i),i.classList?.[0]==="nav-item"&&d.emit("dom-up-nav-item",i);let c=document.querySelector(".ck.ck-content.ck-editor__editable")?.ckeditorInstance;!R&&c&&(c.model.document.on("change",(o,l)=>{l.operations.forEach(u=>{u=u.toJSON(),u?.baseVersion&&u.nodes?.[0]?.data})}),R=!0)})}).observe(document.body,{childList:!0,subtree:!0}),document.addEventListener("contextmenu",b),location.hash=="#/blank"?navigation.addEventListener("navigatesuccess",()=>{d.emit("change_href",location)}):d.emit("change_href",location)}A();z();
